<script>
// ===== stock-like curve =====
const line = document.getElementById('mainLine');
const fill = document.getElementById('dangerFill');
const dot  = document.getElementById('spikeDot');

function buildPath(values){
  const w = 600;
  const h = 140;
  const step = w/(values.length-1);
  return values.map((v,i)=>{
    const x = i*step;
    const y = h - v;
    return `${i===0?'M':'L'}${x},${y}`;
  }).join(' ');
}

function buildFill(values){
  const w = 600;
  const h = 140;
  const step = w/(values.length-1);
  let path = `M0,95`;
  values.forEach((v,i)=>{
    const x = i*step;
    const y = h - v;
    if(y < 95){
      path += ` L${x},${y}`;
    }
  });
  path += ` L${w},95 Z`;
  return path;
}

function drawNormal(){
  const data = [20,22,21,23,22,24,23,25,24,23];
  line.setAttribute('d', buildPath(data));
  fill.setAttribute('d', '');
  dot.style.display = 'none';
}

function drawIncident(){
  const data = [22,24,26,28,35,60,110,95,80,70];
  line.setAttribute('d', buildPath(data));
  fill.setAttribute('d', buildFill(data));

  // spike position
  const w = 600/(data.length-1);
  dot.setAttribute('cx', 6*w);
  dot.setAttribute('cy', 140-data[6]);
  dot.style.display = 'block';
}

function drawControlled(){
  const data = [22,24,26,28,35,60,75,65,55,48];
  line.setAttribute('d', buildPath(data));
  fill.setAttribute('d', buildFill(data));
  dot.style.display = 'none';
}

// hook into your existing flow
setTimeout(drawNormal, 100);
setTimeout(drawIncident, 1800);
setTimeout(drawControlled, 6200);

document.getElementById('btnLimit').addEventListener('click', drawControlled);
document.getElementById('btnReset').addEventListener('click', drawNormal);
</script>
